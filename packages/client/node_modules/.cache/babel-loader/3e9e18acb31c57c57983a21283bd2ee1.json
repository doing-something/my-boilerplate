{"ast":null,"code":"import _slicedToArray from \"/home/skyparci/work/my-boilerplate/packages/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectSpread from \"/home/skyparci/work/my-boilerplate/packages/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport { useEffect, useReducer, useCallback, useRef } from 'react';\nimport validate from './validate';\nimport { initializeFormState, trimFormValues, detectFormErrors, createErrorState, createInputState } from './utils'; // global\n\nimport { useGlobalStateContext } from 'global';\n\nfunction reducer(state, {\n  type,\n  payload\n}) {\n  switch (type) {\n    case 'SUBMIT_READY':\n      return _objectSpread({}, state, {\n        isSubmitting: payload\n      });\n\n    case 'SET_FORM_STATE':\n      return _objectSpread({}, state, {\n        formState: _objectSpread({}, state.formState, payload)\n      });\n\n    case 'SET_FORM_VALUES':\n      return _objectSpread({}, state, {\n        formValues: payload\n      });\n\n    default:\n      return state;\n  }\n}\n\nconst useForm = (configs = {}, submitCallback) => {\n  const _useGlobalStateContex = useGlobalStateContext(),\n        LOG = _useGlobalStateContex.LOG;\n\n  const _initializeFormState = initializeFormState(configs),\n        _initializeFormState2 = _slicedToArray(_initializeFormState, 2),\n        initialFormState = _initializeFormState2[0],\n        validator = _initializeFormState2[1];\n\n  const _useReducer = useReducer(reducer, {\n    isSubmitting: false,\n    formState: initialFormState,\n    formValues: null\n  }),\n        _useReducer2 = _slicedToArray(_useReducer, 2),\n        state = _useReducer2[0],\n        dispatch = _useReducer2[1];\n\n  const isSubmitting = state.isSubmitting,\n        formState = state.formState,\n        formValues = state.formValues;\n  const validateForm = validate(validator);\n  const submitCallbackRef = useRef(submitCallback);\n  useEffect(() => {\n    submitCallbackRef.current = submitCallback;\n  }, [submitCallback]);\n  useEffect(() => {\n    if (isSubmitting) {\n      submitCallbackRef.current(formValues);\n    }\n  }, [formValues, isSubmitting]);\n\n  function validateAll(validator, values, formState) {\n    const errorResult = detectFormErrors(validator, formState, validateForm);\n\n    const _createErrorState = createErrorState(errorResult, values),\n          _createErrorState2 = _slicedToArray(_createErrorState, 2),\n          hasError = _createErrorState2[0],\n          errorFormState = _createErrorState2[1];\n\n    dispatch({\n      type: 'SET_FORM_STATE',\n      payload: errorFormState\n    });\n    if (!hasError) dispatch({\n      type: 'SUBMIT_READY',\n      payload: true\n    });\n  }\n\n  function onSubmit(event) {\n    if (event) event.preventDefault();\n    const trimmedValues = trimFormValues(formState);\n    if (!trimmedValues) return false;\n    dispatch({\n      type: 'SET_FORM_VALUES',\n      payload: trimmedValues\n    });\n    validateAll(validator, trimmedValues, formState);\n  }\n\n  function onChange(name, value) {\n    if (!name) return;\n\n    const _validateForm = validateForm(name, value, formState),\n          _validateForm2 = _slicedToArray(_validateForm, 2),\n          ok = _validateForm2[0],\n          message = _validateForm2[1];\n\n    LOG('ok', ok);\n    dispatch({\n      type: 'SET_FORM_STATE',\n      payload: {\n        [name]: createInputState(name, value, message)\n      }\n    });\n    dispatch({\n      type: 'SUBMIT_READY',\n      payload: false\n    });\n  }\n\n  const handleSubmit = useCallback(onSubmit, [formState]);\n  const handleChange = useCallback(onChange, [formState]);\n  return {\n    formState,\n    isSubmitting,\n    handleChange,\n    handleSubmit\n  };\n};\n\nexport default useForm;","map":{"version":3,"sources":["/home/skyparci/work/my-boilerplate/packages/client/src/hooks/useValidation/useValidation.js"],"names":["useEffect","useReducer","useCallback","useRef","validate","initializeFormState","trimFormValues","detectFormErrors","createErrorState","createInputState","useGlobalStateContext","reducer","state","type","payload","isSubmitting","formState","formValues","useForm","configs","submitCallback","LOG","initialFormState","validator","dispatch","validateForm","submitCallbackRef","current","validateAll","values","errorResult","hasError","errorFormState","onSubmit","event","preventDefault","trimmedValues","onChange","name","value","ok","message","handleSubmit","handleChange"],"mappings":"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","sourcesContent":["import { useEffect, useReducer, useCallback, useRef } from 'react';\nimport validate from './validate';\nimport {\n    initializeFormState,\n    trimFormValues,\n    detectFormErrors,\n    createErrorState,\n    createInputState,\n} from './utils';\n// global\nimport { useGlobalStateContext } from 'global';\n\nfunction reducer(state, { type, payload }) {\n    switch (type) {\n        case 'SUBMIT_READY':\n            return { ...state, isSubmitting: payload };\n        case 'SET_FORM_STATE':\n            return {\n                ...state,\n                formState: {\n                    ...state.formState,\n                    ...payload,\n                },\n            };\n        case 'SET_FORM_VALUES':\n            return { ...state, formValues: payload };\n        default:\n            return state;\n    }\n}\n\nconst useForm = (configs: ConfigsType = {}, submitCallback: func): any => {\n    const { LOG } = useGlobalStateContext();\n    const [initialFormState, validator] = initializeFormState(configs);\n    const [state, dispatch] = useReducer(reducer, {\n        isSubmitting: false,\n        formState: initialFormState,\n        formValues: null,\n    });\n    const { isSubmitting, formState, formValues } = state;\n    const validateForm = validate(validator);\n    const submitCallbackRef = useRef(submitCallback);\n\n    useEffect(() => {\n        submitCallbackRef.current = submitCallback;\n    }, [submitCallback]);\n\n    useEffect(() => {\n        if (isSubmitting) {\n            submitCallbackRef.current(formValues);\n        }\n    }, [formValues, isSubmitting]);\n\n    function validateAll(validator, values, formState) {\n        const errorResult = detectFormErrors(\n            validator,\n            formState,\n            validateForm,\n        );\n        const [hasError, errorFormState] = createErrorState(\n            errorResult,\n            values,\n        );\n\n        dispatch({ type: 'SET_FORM_STATE', payload: errorFormState });\n\n        if (!hasError) dispatch({ type: 'SUBMIT_READY', payload: true });\n    }\n\n    function onSubmit(event) {\n        if (event) event.preventDefault();\n\n        const trimmedValues = trimFormValues(formState);\n\n        if (!trimmedValues) return false;\n\n        dispatch({ type: 'SET_FORM_VALUES', payload: trimmedValues });\n\n        validateAll(validator, trimmedValues, formState);\n    }\n\n    function onChange(name, value) {\n        if (!name) return;\n        const [ok, message] = validateForm(name, value, formState);\n        LOG('ok', ok);\n        dispatch({\n            type: 'SET_FORM_STATE',\n            payload: {\n                [name]: createInputState(name, value, message),\n            },\n        });\n        dispatch({ type: 'SUBMIT_READY', payload: false });\n    }\n\n    const handleSubmit = useCallback(onSubmit, [formState]);\n    const handleChange = useCallback(onChange, [formState]);\n\n    return {\n        formState,\n        isSubmitting,\n        handleChange,\n        handleSubmit,\n    };\n};\n\nexport default useForm;\n"]},"metadata":{},"sourceType":"module"}